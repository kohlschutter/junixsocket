<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/release.md at 2022-06-06
 | Rendered using Apache Maven Fluido Skin 1.11.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>junixsocket &#x2013; How to release junixsocket</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.11.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.11.0.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/kohlschutter/junixsocket">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>junixsocket — Unix Domain Sockets for Java</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-06-06<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.5.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Welcome"><span class="none"></span>Welcome</a></li>
    <li><a href="changelog.html" title="New & Noteworthy"><span class="none"></span>New & Noteworthy</a></li>
    <li><a href="quickstart.html" title="Quick Start"><span class="none"></span>Quick Start</a></li>
    <li><a href="compatibility.html" title="Compatibility"><span class="none"></span>Compatibility</a></li>
    <li><a href="dependency.html" title="Add junixsocket to your project"><span class="none"></span>Add junixsocket to your project</a></li>
    <li><a href="faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Demo Code</li>
    <li><a href="demo.html" title="Command line demos"><span class="none"></span>Command line demos</a></li>
    <li><a href="junixsocket-demo/xref/index.html" title="Source reference"><span class="none"></span>Source reference</a></li>
    <li><a href="filedescriptors.html" title="Sending file descriptors"><span class="none"></span>Sending file descriptors</a></li>
    <li><a href="peercreds.html" title="Peer credentials"><span class="none"></span>Peer credentials</a></li>
   <li class="nav-header">For Developers</li>
    <li><a href="development.html" title="Developing junixsocket"><span class="none"></span>Developing junixsocket</a></li>
    <li><a href="unixsockets.html" title="Unix Sockets Reference"><span class="none"></span>Unix Sockets Reference</a></li>
    <li><a href="customarch.html" title="Custom architectures"><span class="none"></span>Custom architectures</a></li>
    <li><a href="crosscomp.html" title="Cross-Compiling with crossclang"><span class="none"></span>Cross-Compiling with crossclang</a></li>
    <li><a href="eclipse.html" title="Developing with Eclipse"><span class="none"></span>Developing with Eclipse</a></li>
    <li class="active"><a><span class="none"></span>Release Instructions</a></li>
   <li class="nav-header">Reference</li>
    <li><a href="junixsocket-codecoverage/jacoco-aggregate/index.html" title="Code Coverage"><span class="none"></span>Code Coverage</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="junixsocket-common/index.html" title="junixsocket-common"><span class="none"></span>junixsocket-common</a></li>
    <li><a href="junixsocket-tipc/index.html" title="junixsocket-tipc"><span class="none"></span>junixsocket-tipc</a></li>
    <li><a href="junixsocket-server/index.html" title="junixsocket-server"><span class="none"></span>junixsocket-server</a></li>
    <li><a href="junixsocket-rmi/index.html" title="junixsocket-rmi"><span class="none"></span>junixsocket-rmi</a></li>
    <li><a href="junixsocket-mysql/index.html" title="junixsocket-mysql"><span class="none"></span>junixsocket-mysql</a></li>
    <li><a href="junixsocket-core/index.html" title="junixsocket-core"><span class="none"></span>junixsocket-core</a></li>
    <li><a href="junixsocket-demo/index.html" title="junixsocket-demo"><span class="none"></span>junixsocket-demo</a></li>
    <li><a href="junixsocket-selftest/index.html" title="junixsocket-selftest"><span class="none"></span>junixsocket-selftest</a></li>
    <li><a href="junixsocket-dist/index.html" title="junixsocket-dist"><span class="none"></span>junixsocket-dist</a></li>
    <li><a href="junixsocket-codecoverage/index.html" title="junixsocket-codecoverage"><span class="none"></span>junixsocket-codecoverage</a></li>
    <li><a href="junixsocket-native/index.html" title="junixsocket-native"><span class="none"></span>junixsocket-native</a></li>
    <li><a href="junixsocket-native-cross/index.html" title="junixsocket-native-cross"><span class="none"></span>junixsocket-native-cross</a></li>
    <li><a href="junixsocket-native-custom/index.html" title="junixsocket-native-custom"><span class="none"></span>junixsocket-native-custom</a></li>
    <li><a href="junixsocket-native-common/index.html" title="junixsocket-native-common"><span class="none"></span>junixsocket-native-common</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>How to release junixsocket</h1>
<p>NOTE: This is probably not interesting unless you're the project admin or going to fork it.</p><section>
<h2><a name="Prerequisites"></a>Prerequisites</h2><section>
<h3><a name="llvm_and_mingw-w64"></a>llvm and mingw-w64</h3>
<p>In order to build for all supported target platforms included in the release, our development
machine (the one where we do the compilation), needs to have clang and llvm, as well as
x86_64-w64-mingw32-gcc, a GCC compiler binary to allow building for Windows.</p>
<p>On Mac, run the following command.</p>

<div class="source"><pre class="prettyprint"><code>brew install llvm llvm@9 mingw-w64
</code></pre></div>
<p>If you don't have Homebrew, obtain it from <a class="externalLink" href="https://brew.sh/">here</a> first.</p></section><section>
<h3><a name="github.com_credentials"></a>github.com credentials</h3>
<ol style="list-style-type: decimal">

<li>On github.com, create an OAuth token with write permissions to the repo.</li>
<li>Add the credentials to your keychain</li>
</ol></section><section>
<h3><a name="GPG_keys"></a>GPG keys</h3>
<p>Instructions for macOS</p>
<ul>

<li>

<p>Install gpg and helper tools</p>
<p>brew install gpg gpg2 gpg-agent pinentry-mac</p>
</li>
<li>

<p>Enable pinentry-mac</p>
<p>This gives a nice GUI for the passphrase, and allows us to store the GPG key passphrase in the macOS keychain)</p>
<h1>open or create ~/.gnupg/gpg-agent.conf</h1>
<h1>then add the following line if it doesn't exist yet:</h1>
<p>pinentry-program /usr/local/bin/pinentry-mac</p>
</li>
<li>

<p>Generate GPG key</p>
<p>gpg2 &#x2013;generate-key</p>
<p>Follow on-screen instructions. Use a long, memorable passphrase.</p>
<p>Remember the GPG key ID. Publish the corresponding GPG public key on the GPG keyservers:</p>
<p>gpg2 &#x2013;keyserver <a class="externalLink" href="hkp://hkps.pool.sks-keyservers.net">hkp://hkps.pool.sks-keyservers.net</a> &#x2013;send-key THEKEYID</p>
</li>
</ul></section><section>
<h3><a name="Build_environment_for_other_platforms"></a>Build environment for other platforms</h3>
<p>Currently, the easiest way to build for other platforms is to have a working Java 9 (or later)
environment, Maven 3+ and the junixsocket project ready. Just spin up a virtual machine (or emulator),
install Java, Maven and junixsocket, and you should be good to go.</p></section></section><section>
<h2><a name="Common_tasks"></a>Common tasks</h2><section>
<h3><a name="Ensure_the_code_is_properly_formatted_and_licenses_are_in_place"></a>Ensure the code is properly formatted and licenses are in place</h3>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
# review LICENSE file and verify that it's up-to-date
mvn formatter:format
mvn license:format
# git add / commit here...
</code></pre></div></section><section>
<h3><a name="Bump_project_version"></a>Bump project version</h3>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
mvn versions:set -DnewVersion=2.5.0
# git add / commit here...
</code></pre></div></section><section>
<h3><a name="Build_native_libraries_on_other_supported.2C_common_platforms"></a>Build native libraries on other supported, common platforms</h3>
<p>This currently means amd64-Linux-gpp in addition to our default x86_64-MacOSX-gpp environment.</p>
<p>On the target machine, install junixsocket. Make sure you use the very same version as on your
development machine from where you do the release!</p>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
mvn clean install -Pstrict
</code></pre></div>
<p>The platform-dependent nar files should now be available in the local maven repository cache.</p>
<p>Use the provided script to copy the corresponding nar to a project folder:</p>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
# replace 2.5.0 with the desired version number
junixsocket-native-prebuilt/bin/copy-nar-from-m2repo.sh 2.5.0
</code></pre></div>
<p>Now copy the nar files from the target machine to your development computer (from where you do the release).
By convention, copy the files to the same folder as on the target machine (<i>junixsocket/junixsocket-native-prebuilt/bin</i>)</p>
<p>On the development computer, install the nar files in the local Maven repository cache:</p>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
junixsocket-native-prebuilt/bin/install-to-m2repo.sh junixsocket-native-prebuilt/nar/*nar
</code></pre></div></section><section>
<h3><a name="Create_binary_distribution"></a>Create binary distribution</h3>
<p>This will create a directory, a .tar.gz and a .zip archive, containing the project jars and
a script to run the demo classes from the command-line.</p>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
mvn clean install -Pstrict -Prelease
</code></pre></div>
<p>The files can be found in</p>
<ul>

<li><code>junixsocket/junixsocket-dist/target/junixsocket-dist-2.5.0-bin</code></li>
<li><code>junixsocket/junixsocket-dist/target/junixsocket-dist-2.5.0-bin.tar.gz</code></li>
<li><code>junixsocket/junixsocket-dist/target/junixsocket-dist-2.5.0-bin.zip</code></li>
</ul></section><section>
<h3><a name="Deploy_code_to_Maven_central"></a>Deploy code to Maven central</h3><section>
<h4><a name="a1._Deploy_to_staging"></a>1. Deploy to staging</h4>

<div class="source"><pre class="prettyprint"><code>cd junixsocket
mvn clean install -Pstrict -Prelease

# after gpgkeyname, specify the key you want to use for signing
mvn deploy -Pstrict -Prelease -Psigned -Dgpgkeyname=your@email.com -Dgpg.executable=$(which gpg)
</code></pre></div><section>
<h5><a name="Notes"></a>Notes</h5>
<p><code>-Pstrict</code> enforces code quality checks to succeed (e.g., <i>spotbugs</i>, <i>checkstyle</i>).</p>
<p><code>-Prelease</code> makes sure we include all common native binaries in junixsocket-native-common.</p>
<p><code>-Psigned</code> enables signing the artifacts with our GPG key.</p></section><section>
<h5><a name="In_case_of_failures_while_staging:"></a>In case of failures while staging:</h5>
<p>If the deployment fails with <code>Remote staging failed: Staging rules failure!</code> and due to
<code>No public key: Key with id: (...) was not able to be located on ...</code>,
then that means that the GPG key you created above has not been fully distributed among the GPG key
servers. Try to manually push to the ones mentioned in the error message, and try again.</p>
<p>For example:</p>

<div class="source"><pre class="prettyprint"><code>gpg2 --keyserver http://keyserver.ubuntu.com:11371 --send-key THEKEYID
</code></pre></div>
<p>If you get an error <code>Remote staging failed: A message body reader for Java class com.sonatype.nexus.staging.api.dto.StagingProfileRepositoryDTO, and Java type class com.sonatype.nexus.staging.api.dto.StagingProfileRepositoryDTO, and MIME media type text/html was not found</code>, then simply try again; see <a class="externalLink" href="https://issues.sonatype.org/browse/OSSRH-51097">OSSRH-51097</a>.</p></section></section><section>
<h4><a name="a2._Review_the_deployed_artifacts"></a>2. Review the deployed artifacts</h4>
<p>The URL of the staging repository is <code>https://oss.sonatype.org/content/groups/staging</code>.
The artifacts can be found <a class="externalLink" href="https://oss.sonatype.org/content/groups/staging/com/kohlschutter/">here</a>.</p>
<p>If you're deploying a <code>-SNAPSHOT</code> version, you can find the artifacts
<a class="externalLink" href="https://oss.sonatype.org/content/repositories/snapshots/com/kohlschutter/junixsocket/">here</a>.</p>
<p><b>IMPORTANT</b> Double-check that the staged junixsocket-native-common artifact contains all required
library binaries (macOS, Linux 64-bit, etc.).</p>
<p>At that point, it is a good idea to download the junixsocket-selftest-jar-with-dependencies.jar,
and try it on all supported platforms. The last output line should say &#x201c;Selftest PASSED&#x201d;.</p></section><section>
<h4><a name="a3._Release_artifact_to_Maven_Central"></a>3. Release artifact to Maven Central</h4>
<p><b>IMPORTANT</b> Once released, it cannot be undone! Make sure you verify the staged artifact first!</p>

<div class="source"><pre class="prettyprint"><code>MAVEN_OPTS=&quot;--add-opens java.base/java.util=ALL-UNNAMED&quot; mvn nexus-staging:release -Prelease
</code></pre></div>
<p>NOTE: There can be quite a delay (30 minutes?) until the artifact is deployed in Maven Central.</p></section></section><section>
<h3><a name="Tag_the_release.2C_push_to_upstream_.28i.e..2C_GitHub.29"></a>Tag the release, push to upstream (i.e., GitHub)</h3>

<div class="source"><pre class="prettyprint"><code>mvn scm:tag
</code></pre></div></section><section>
<h3><a name="Release_on_GitHub"></a>Release on GitHub</h3>
<ol style="list-style-type: decimal">

<li>

<p>Log in to GitHub, go to Releases -&gt; Draft a new release.</p>
</li>
<li>

<p>Select the newly created tag (= search for the version).</p>
</li>
<li>

<p>Release title = &#x201c;junixsocket&#x201d; + version&gt;, e.g., &#x201c;junixsocket 2.5.0&#x201d;</p>
</li>
<li>

<p>Hit &#x201c;Publish release&#x201d;</p>
</li>
</ol></section><section>
<h3><a name="Publish_website"></a>Publish website</h3>
<p>This builds the Maven site and publishes it to <a class="externalLink" href="https://kohlschutter.github.io/junixsocket/">https://kohlschutter.github.io/junixsocket/</a>.</p>

<div class="source"><pre class="prettyprint"><code>cd junixsocket 
mvn clean install site site:stage -Pstrict -Prelease
mvn scm-publish:publish-scm -Pstrict -Prelease
</code></pre></div>
<p>NOTE: There can be a 10-minute delay until the pages get updated automatically in your browser cache.
Hit refresh to expedite.</p></section><section>
<h3><a name="Prepare_next_version"></a>Prepare next version</h3>

<div class="source"><pre class="prettyprint"><code>mvn versions:set -DnewVersion=X.Y.Z-SNAPSHOT
mvn clean install
</code></pre></div></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2009&#x2013;2022
<a href="https://www.kohlschutter.com/">Kohlschütter Search Intelligence</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>