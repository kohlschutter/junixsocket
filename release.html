<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M13 from src/site/markdown/release.md.vm at 2024-09-23
 | Rendered using Apache Maven Fluido Skin 2.0.0-M8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M13" />
    <title>junixsocket – How to release junixsocket</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M8.min.js"></script>
  </head>
  <body>
    <a class="github-fork-ribbon right-top" href="https://github.com/kohlschutter/junixsocket" data-ribbon="Fork me on GitHub">Fork me on GitHub</a>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>junixsocket — Unix Domain Sockets for Java</h1></div></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-09-23<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.10.1</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html">Welcome</a></li>
    <li><a href="changelog.html">New &amp; Noteworthy</a></li>
    <li><a href="quickstart.html">Quick Start</a></li>
    <li><a href="building.html">Building</a></li>
    <li><a href="compatibility.html">Compatibility</a></li>
    <li><a href="selftest.html">Selftest</a></li>
    <li><a href="dependency.html">Add junixsocket to your project</a></li>
    <li><a href="graalvm.html">GraalVM support</a></li>
   <li class="nav-header">Reference</li>
    <li><a href="apidocs/index.html">API Javadoc</a></li>
    <li><a href="xref/index.html">Source xref</a></li>
    <li><a href="xref-test/index.html">Test xref</a></li>
    <li><a href="junixsocket-codecoverage/jacoco-aggregate/index.html">Code Coverage</a></li>
   <li class="nav-header">Protocols</li>
    <li><a href="junixsocket-tipc/index.html">AF_TIPC</a></li>
    <li><a href="quickstart.html">AF_UNIX</a></li>
    <li><a href="junixsocket-vsock/index.html">AF_VSOCK</a></li>
    <li><a href="junixsocket-darwin/index.html">AF_SYSTEM</a></li>
   <li class="nav-header">Demo Code</li>
    <li><a href="demo.html">Command line demos</a></li>
    <li><a href="junixsocket-demo/xref/index.html">Source reference</a></li>
    <li><a href="filedescriptors.html">File descriptors</a></li>
    <li><a href="peercreds.html">Peer credentials</a></li>
    <li><a href="http.html">HTTP over Unix sockets</a></li>
   <li class="nav-header">For Developers</li>
    <li><a href="development.html">Developing junixsocket</a></li>
    <li><a href="unixsockets.html">Unix Sockets Reference</a></li>
    <li><a href="customarch.html">Custom architectures</a></li>
    <li><a href="crosscomp.html">Cross-Compiling with crossclang</a></li>
    <li><a href="eclipse.html">Developing with Eclipse</a></li>
    <li><a href="xcode.html">Developing with Xcode</a></li>
    <li><a href="otherbugs.html">Bugs in other places</a></li>
    <li class="active"><a>Release Instructions</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="junixsocket-common/index.html">junixsocket-common</a></li>
    <li><a href="junixsocket-tipc/index.html">junixsocket-tipc</a></li>
    <li><a href="junixsocket-vsock/index.html">junixsocket-vsock</a></li>
    <li><a href="junixsocket-darwin/index.html">junixsocket-darwin</a></li>
    <li><a href="junixsocket-server/index.html">junixsocket-server</a></li>
    <li><a href="junixsocket-ssl/index.html">junixsocket-ssl</a></li>
    <li><a href="junixsocket-rmi/index.html">junixsocket-rmi</a></li>
    <li><a href="junixsocket-mysql/index.html">junixsocket-mysql</a></li>
    <li><a href="junixsocket-core/index.html">junixsocket-core</a></li>
    <li><a href="junixsocket-demo/index.html">junixsocket-demo</a></li>
    <li><a href="junixsocket-demo-jpackagejlink/index.html">junixsocket-demo-jpackagejlink</a></li>
    <li><a href="junixsocket-dist/index.html">junixsocket-dist</a></li>
    <li><a href="junixsocket-codecoverage/index.html">junixsocket-codecoverage</a></li>
    <li><a href="junixsocket-native-custom/index.html">junixsocket-native-custom</a></li>
    <li><a href="junixsocket-native-android/index.html">junixsocket-native-android</a></li>
    <li><a href="junixsocket-jetty/index.html">junixsocket-jetty</a></li>
    <li><a href="junixsocket-jetty-11/index.html">junixsocket-jetty-11</a></li>
    <li><a href="junixsocket-selftest/index.html">junixsocket-selftest</a></li>
    <li><a href="junixsocket-selftest-native-image/index.html">junixsocket-selftest-native-image</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section>
<h1>How to release junixsocket</h1>
<p>This is mostly relevant only if you're the project admin or going to fork the project.</p><section>
<h2>Prerequisites</h2><section>
<h3>llvm and mingw-w64</h3>
<p>In order to build for all supported target platforms included in the release, our development
machine (the one where we do the compilation), needs to have clang and llvm, as well as
x86_64-w64-mingw32-gcc, a GCC compiler binary to allow building for Windows.</p>
<p>On Mac, run the following command.</p>

<div class="verbatim">
<pre><code>brew install llvm mingw-w64
</code></pre></div>
<p>If you don't have Homebrew, obtain it from <a href="https://brew.sh/" class="externalLink">here</a> first.</p>
<p>Note that there currently is an incompatibility with mingw 12.0. To use mingw 11.0, run the
following commands:</p>

<div class="verbatim">
<pre><code>brew remove mingw-w64
wget https://raw.githubusercontent.com/Homebrew/homebrew-core/0247512f8a852f36f14b11809ac08a402de1f9e5/Formula/m/mingw-w64.rb
brew install ./mingw-w64.rb
brew pin mingw-w64
</code></pre></div></section><section>
<h3>github.com credentials</h3>
<ol style="list-style-type: decimal;">

<li>On github.com, create an OAuth token with write permissions to the repo.</li>
<li>Add the credentials to your keychain</li>
</ol></section><section>
<h3>GPG keys</h3>
<p>Instructions for macOS</p>
<ul>

<li>
<p>Install gpg and helper tools</p>
<p>brew install gpg gpg2 gpg-agent pinentry-mac</p></li>
<li>
<p>Enable pinentry-mac</p>
<p>This gives a nice GUI for the passphrase, and allows us to store the GPG key passphrase in the
macOS keychain)</p></li>
<li>
<p>Open or create <code>~/.gnupg/gpg-agent.conf</code>
then add the following line if it doesn't exist yet:</p>

<div class="verbatim">
<pre><code> pinentry-program /usr/local/bin/pinentry-mac
</code></pre></div></li>
<li>
<p>Generate a GPG key</p>

<div class="verbatim">
<pre><code> gpg2 --generate-key
</code></pre></div>
<p>Follow on-screen instructions. Use a long, memorable passphrase.</p></li>
<li>
<p>Remember the GPG key ID. Publish the corresponding GPG public key on the GPG keyservers:</p>

<div class="verbatim">
<pre><code> gpg2 --send-key THEKEYID
</code></pre></div></li>
</ul></section><section>
<h3>Build environment for other platforms</h3>
<p>Currently, the easiest way to build for other platforms is to have a working Java 9 (or later)
environment, Maven 3+ and the junixsocket project ready.  Just spin up a virtual machine (or
emulator), install Java, Maven and junixsocket, and you should be good to go.</p></section></section><section>
<h2>Common tasks</h2><section>
<h3>Update changelog, website, README.md</h3>
<p>Update <code>junixsocket/src/site/markdown/changelog.md</code> with a section for the new version and all
noteworthy changes.</p>
<p>Check all mentions (execpet for <code>changelog.md</code>) of the current junixsocket under
<code>junixsocket/src/site/markdown</code>, and replace accordingly:
<code>grep X.Y.Z src/site/markdown/* | grep -v changelog.md:</code></p>
<p>Also update the dependency statement in <code>junixsocket/README.md</code>.</p>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the current version)</p>
</blockquote></section><section>
<h3>Ensure GraalVM native configs are still up-to-date</h3>
<p>Run <code>junixsocket-native-graalvm/bin/with-graalvm junixsocket-native-graalvm/bin/build-selftest</code></p>
<p>If, at the end, you see changes to the json files in <code>junixsocket-native-graalvm/output</code>, review
them, modify the json files in
<code>junixsocket-{common,tipc,vsock,selftest,...}/src/main/resources/META-INF/native-image</code> accordingly,
and add/commit both sets of changes.</p></section><section>
<h3>Ensure the code is properly formatted and licenses are in place</h3>
<p>First, view the <code>LICENSE</code> file and verify that it's up to date. Then run the code formatters and commit.</p>

<div class="verbatim">
<pre><code>cd junixsocket
mvn process-sources -Dreformat
# git add / commit here...
</code></pre></div></section><section>
<h3>Bump project version</h3>

<div class="verbatim">
<pre><code>cd junixsocket
mvn versions:set -DnewVersion=X.Y.Z
# git add / commit here...
</code></pre></div>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the actual new version)</p>
</blockquote></section><section>
<h3>Build native libraries on other supported, common platforms</h3>
<blockquote>

<p><em>NOTE:</em> This section can presently be skipped since all targets shipped in <code>junixsocket-native-common</code> cross-compile with <code>-Drelease</code>.</p>
</blockquote>
<p>On the target machine, install junixsocket. Make sure you use the very same version as on your
development machine from where you do the release!</p>

<div class="verbatim">
<pre><code>cd junixsocket
mvn clean install -Dstrict
</code></pre></div>
<p>The platform-dependent nar files should now be available in the local maven repository cache.</p>
<p>Use the provided script to copy the corresponding nar to a project folder:</p>

<div class="verbatim">
<pre><code>cd junixsocket
junixsocket-native-prebuilt/bin/copy-nar-from-m2repo.sh X.Y.Z
</code></pre></div>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the actual version)</p>
</blockquote>
<p>Now copy the nar files from the target machine to your development computer (from where you do the release).
By convention, copy the files to the same folder as on the target machine (<em>junixsocket/junixsocket-native-prebuilt/bin</em>)</p>
<p>On the development computer, install the nar files in the local Maven repository cache:</p>

<div class="verbatim">
<pre><code>cd junixsocket
junixsocket-native-prebuilt/bin/install-to-m2repo.sh junixsocket-native-prebuilt/nar/*nar
</code></pre></div></section><section>
<h3>Create binary distribution</h3>
<p>This will create a directory, a .tar.gz and a .zip archive, containing the project jars and
a script to run the demo classes from the command-line.</p>

<div class="verbatim">
<pre><code>cd junixsocket
mvn clean install -Dstrict -Drelease
</code></pre></div>
<p>The files can be found in</p>
<ul>

<li><code>junixsocket/junixsocket-dist/target/junixsocket-dist-X.Y.Z-bin</code></li>
<li><code>junixsocket/junixsocket-dist/target/junixsocket-dist-X.Y.Z-bin.tar.gz</code></li>
<li><code>junixsocket/junixsocket-dist/target/junixsocket-dist-X.Y.Z-bin.zip</code></li>
</ul>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the actual version)</p>
</blockquote></section><section>
<h3>Verify that Selftest works</h3>
<p>Run <code>java -jar junixsocket-selftest/target/junixsocket-selftest-X.Y.Z-jar-with-dependencies.jar</code>. It should end with <code>Selftest PASSED</code>.</p>
<p>Also run the selftest with Java 8, e.g.:</p>

<div class="verbatim">
<pre><code>/Library/Java/JavaVirtualMachines/1.8.0.jdk/Contents/Home/bin/java -jar junixsocket-selftest/target/junixsocket-selftest-2.10.1-jar-with-dependencies.jar
</code></pre></div>
<p>Run <code>junixsocket-native-graalvm/bin/with-graalvm mvn package -pl junixsocket-selftest-native-image -Dnative</code>
(on all native-image supported platforms) to build the GraalVM native-image.  Test the native-image
by running <code>junixsocket-selftest-native-image/target/junixsocket-selftest-native-image-X.Y.Z</code>.</p>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the actual version)</p>
</blockquote></section><section>
<h3>Deploy code to Maven central</h3><section>
<h4>Tag the release, push to upstream (i.e., GitHub)</h4>

<div class="verbatim">
<pre><code>mvn scm:tag
</code></pre></div>
<p>If you need to make a revision afterwards, retag with <code>git tag -f TAG</code> and <code>git push origin TAG --force</code>.</p></section><section>
<h4>Deploy to staging</h4>

<div class="verbatim">
<pre><code>cd junixsocket
mvn clean install -Drelease -Dstrict

mvn clean deploy -Drelease -Ddeploy -Dignorant -D -DskipTests -Dsigned -Dgpgkeyname=$(git config --get user.email) -Dgpg.executable=$(which gpg)
</code></pre></div><section>
<h5>Notes</h5>
<p><code>-Drelease</code> makes sure we include all common native binaries in junixsocket-native-common.</p>
<p><code>-Dstrict</code> enforces code quality checks to succeed (e.g., <em>spotbugs</em>, <em>checkstyle</em>).</p>
<p><code>-Dignorant</code> disables linters, code quality checks, javadoc, source jars, etc.</p>
<p><code>-Ddeploy</code> re-enable javadoc/attach-sources even with <code>-Dignorant</code> set.</p>
<p><code>-DskipTests</code> skips unit testing.</p>
<p><code>-Dsigned</code> enables signing the artifacts with our GPG key (using the key name specified with <code>-Dgpgkeyname=</code> and the gpg executable specified with <code>-Dgpg.executable=</code>).</p></section><section>
<h5>In case of failures while staging:</h5>
<p>If the deployment fails with <code>Remote staging failed: Staging rules failure!</code> and due to
<code>No public key: Key with id: (...) was not able to be located on ...</code>,
then that means that the GPG key you created above has not been fully distributed among the GPG key
servers. Try to manually push to the ones mentioned in the error message, and try again.</p>
<p>For example:</p>

<div class="verbatim">
<pre><code>gpg2 --keyserver http://keyserver.ubuntu.com:11371 --send-key THEKEYID
</code></pre></div>
<p>If you get an error <code>Remote staging failed: A message body reader for Java class com.sonatype.nexus.staging.api.dto.StagingProfileRepositoryDTO, and Java type class com.sonatype.nexus.staging.api.dto.StagingProfileRepositoryDTO, and MIME media type text/html was not found</code>, then simply try again; see <a href="https://issues.sonatype.org/browse/OSSRH-51097" class="externalLink">OSSRH-51097</a>.</p></section></section><section>
<h4>Review the deployed artifacts</h4>
<p>The URL of the staging repository is <code>https://oss.sonatype.org/content/groups/staging</code>.
The artifacts can be found <a href="https://oss.sonatype.org/content/groups/staging/com/kohlschutter/" class="externalLink">here</a>.</p>
<p>If you're deploying a <code>-SNAPSHOT</code> version, you can find the artifacts
<a href="https://oss.sonatype.org/content/repositories/snapshots/com/kohlschutter/junixsocket/" class="externalLink">here</a>.</p>
<p><strong>IMPORTANT</strong> Double-check that the staged junixsocket-native-common artifact contains all required
library binaries (macOS, Linux 64-bit, etc.).</p></section></section><section>
<h3>Review selftest on all supported platforms</h3>
<p>Download <code>junixsocket-selftest-X.Y.Z-jar-with-dependencies.jar</code> from staging to all supported platforms:</p>

<div class="verbatim">
<pre><code>https://oss.sonatype.org/content/groups/staging/com/kohlschutter/junixsocket/junixsocket-selftest/X.Y.Z/junixsocket-selftest-X.Y.Z-jar-with-dependencies.jar
</code></pre></div>
<p>Run <code>java -jar junixsocket-selftest-X.Y.Z-jar-with-dependencies.jar</code> on all supported platforms and supported JDK combinations.</p>
<p>Depending on the platform, it should end with <code>Selftest PASSED</code> or <code>Selftest PASSED WITH ISSUES</code>.</p>
<p>Also check the header, especially the <code>Git properties</code> at the beginning of the output:</p>
<ul>

<li>The version numbers (<code>junixsocket selftest version</code> and <code>git.build.version</code>) should match the expected version number</li>
<li><code>git.dirty</code> should be <code>false</code></li>
<li><code>git.commit.id.describe</code> should match the new git tag.</li>
</ul><section>
<h4>Release artifact to Maven Central</h4>
<p><strong>IMPORTANT</strong> Once released, it cannot be undone! Make sure you verify the staged artifact first!</p>

<div class="verbatim">
<pre><code>MAVEN_OPTS=&quot;--add-opens java.base/java.util=ALL-UNNAMED&quot; mvn nexus-staging:release -Drelease
</code></pre></div>
<p>NOTE: There can be quite a delay (30 minutes?) until the artifact is deployed in Maven Central.</p></section></section><section>
<h3>Release on GitHub</h3>
<ol style="list-style-type: decimal;">

<li>
<p>Log in to GitHub, go to Releases -&gt; Draft a new release.</p></li>
<li>
<p>Select the newly created tag (= search for the version).</p></li>
<li>
<p>Release title = &#x201c;junixsocket&#x201d; + version&gt;, e.g., &#x201c;junixsocket X.Y.Z&#x201d;</p></li>
<li>
<p>Paste changelog contents to text field</p></li>
<li>
<p>Upload binaries: <code>junixsocket-dist/target/junixsocket-dist-X.Y.Z-bin.tar.gz</code> /
<code>junixsocket-dist-X.Y.Z-bin.zip</code> as well as
<code>junixsocket-selftest/target/junixsocket-selftest-X.Y.Z-jar-with-dependencies.jar</code></p></li>
<li>
<p>Hit &#x201c;Publish release&#x201d;</p></li>
</ol>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the actual version)</p>
</blockquote></section><section>
<h3>Publish website</h3>
<blockquote>

<p><strong>NOTE:</strong> Maven 3.9.7 and 3.9.8 contain a bug (<a href="https://issues.apache.org/jira/browse/MNG-8178" class="externalLink">MNG-8178</a>) that prevents building the site. Use Maven 3.9.6 instead.</p>
</blockquote>
<p>This builds the Maven site</p>

<div class="verbatim">
<pre><code>cd junixsocket
./scripts/build-site
</code></pre></div>
<p>The website should now be inspected at <code>junixsocket/target/staging/index.html</code></p>
<p>If everything looks good, we can publish it to
<a href="https://kohlschutter.github.io/junixsocket/" class="externalLink">https://kohlschutter.github.io/junixsocket/</a>:</p>

<div class="verbatim">
<pre><code>mvn scm-publish:publish-scm -Dstrict -Drelease
</code></pre></div>
<blockquote>

<p><strong>NOTE:</strong> There can be a 10-minute delay until the pages get updated.</p>
</blockquote>
<blockquote>

<p><strong>FIXME:</strong> We currently don't aggregate code coverage from all platforms. Therefore, especially for <code>TIPC</code> and <code>VSOCK</code> support, the coverage reported is misleading.</p>
</blockquote></section><section>
<h3>Prepare next version</h3>

<div class="verbatim">
<pre><code>mvn versions:set -DnewVersion=X.Y.Z-SNAPSHOT
mvn clean install
</code></pre></div>
<blockquote>

<p><strong>NOTE:</strong> (Replace X.Y.Z with the actual version)</p>
</blockquote></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p id="giscus-parent" style="margin-top:20pt;padding-top:20pt;border-top:thin solid #bbb;">
        <script src="https://giscus.app/client.js"
          data-repo="kohlschutter/junixsocket"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyNzA2NDIwMQ=="
          data-category="Giscus"
          data-category-id="DIC_kwDOAZz3ic4CQT9j"
          data-mapping="pathname"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="light"
          data-lang="en"
          data-loading="lazy"
          crossorigin="anonymous"
          async="async">
        </script>
        <small>
          Discussions widget provided by giscus.app —
          <a
            href="https://github.com/giscus/giscus/blob/main/PRIVACY-POLICY.md"
            target="_top">
            giscus.app privacy policy
          </a> —
          <a href="https://docs.github.com/en/site-policy/github-terms/github-community-guidelines">
          GitHub Community Guidelines
          </a>
        </small>
      </p>
      <script><!--
      document.addEventListener("DOMContentLoaded", function(event) {
        document.getElementById("bodyColumn").appendChild(document.getElementById("giscus-parent"));
      });
      // --></script>
      <p>Copyright 2009–2022
         <a href="https://www.kohlschutter.com/">Kohlschütter Search Intelligence</a>
      </p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>